#!/bin/sh -e
mkdir -p zephyr/fixtures
rm -f zephyr/tests/zephyrdb.test
python manage.py syncdb --noinput --settings=humbug.test_settings
python manage.py migrate --settings=humbug.test_settings --all
# This next line can be simplified to "-n0" once we fix our app with 0 messages.
python manage.py populate_db --settings=humbug.test_settings --test-suite -n2 \
    --threads=1 --huddles=0 --personals=0 --percent-huddles=0 --percent-personals=0
python manage.py dumpdata  --settings=humbug.test_settings \
    auth.User zephyr.UserProfile zephyr.Stream zephyr.Recipient \
    zephyr.Subscription zephyr.Message zephyr.Huddle zephyr.Realm \
    zephyr.UserMessage zephyr.Client \
    zephyr.DefaultStream > zephyr/fixtures/messages.json

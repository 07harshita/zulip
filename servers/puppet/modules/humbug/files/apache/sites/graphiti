<VirtualHost *:80>
    ServerName graphiti.humbughq.com
    Redirect permanent / https://graphiti.humbughq.com/
</VirtualHost>


<VirtualHost *:443>
    ServerName graphiti.humbughq.com

    SSLEngine on
    SSLCertificateFile /etc/apache2/certs/humbug-self-signed.crt
    SSLCertificateKeyFile /etc/apache2/certs/humbug-self-signed.key

    Header add Strict-Transport-Security "max-age=15768000"
    Header add X-Frame-Options DENY

    <Location "/">
        AuthType Digest
        AuthName "wiki"
        AuthDigestProvider file
        AuthUserFile /etc/apache2/users/wiki
        Require valid-user
    </Location>

    # Graphiti reverse-proxy to unicorn serving at localhost:8088

    ProxyRequests Off
    ProxyPreserveHost On

    <Proxy *>
        Order deny,allow
        Allow from all
    </Proxy>

    ProxyPass / http://127.0.0.1:8088/
    ProxyPassReverse / http://127.0.0.1:8088/

    ErrorLog /var/log/apache2/error.log
    LogLevel warn

    CustomLog /var/log/apache2/access.log combined
    ServerSignature On
</VirtualHost>

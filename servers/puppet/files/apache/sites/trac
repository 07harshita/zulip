<VirtualHost *:80>
    ServerName trac.humbughq.com
    Redirect permanent / https://trac.humbughq.com/
</VirtualHost>

<VirtualHost *:443>
    ServerName trac.humbughq.com

    SSLEngine on
    SSLCertificateFile /etc/apache2/certs/humbug-self-signed.crt
    SSLCertificateKeyFile /etc/apache2/certs/humbug-self-signed.key

    Header add Strict-Transport-Security "max-age=15768000"

    RewriteEngine On
    ProxyPreserveHost On
    ProxyRequests Off

    <Proxy *>
       Order deny,allow
       Allow from all

       AuthType Digest
       AuthName "wiki"
       AuthDigestProvider file
       AuthUserFile /etc/apache2/users/wiki
       Require valid-user
    </Proxy>

    ProxyPassReverse /    http://127.0.0.1:5002
    RewriteRule ^(.*) http://127.0.0.1:5002$1 [P]

    ErrorLog /var/log/apache2/error.log
    LogLevel warn

    CustomLog /var/log/apache2/access.log combined
    ServerSignature On
</VirtualHost>

{% extends "zephyr/base.html" %}

{# The app itself. #}
{# Includes some other templates as tabs. #}

{% load jstemplate %}
{% load compressed %}

{% block customhead %}
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script id="template_message" type="text/x-handlebars-template">
{% rawjstemplate "message" %}
</script>

<script id="template_subscription" type="text/x-handlebars-template">
{% rawjstemplate "subscription" %}
</script>

<script id="template_new_stream_users" type="text/x-handlebars-template">
{% rawjstemplate "new_stream_users" %}
</script>

<script id="template_invite_subscription" type="text/x-handlebars-template">
{% rawjstemplate "invite_subscription" %}
</script>

<script id="template_actions_popover_title" type="text/x-handlebars-template">
{% rawjstemplate "actions_popover_title" %}
</script>
<script id="template_actions_popover_content" type="text/x-handlebars-template">
{% rawjstemplate "actions_popover_content" %}
</script>

{% compressed_css 'app' %}
<link rel="stylesheet" href="/static/third/spectrum/spectrum.css" />

<script type="text/javascript" src="/static/third/jquery/jquery.form.js"></script>
<script type="text/javascript" src="/static/third/jquery/jquery.highlight.js"></script>
<script type="text/javascript" src="/static/third/jcaret/jquery.caret.1.02.min.js"></script>
<script type="text/javascript" src="/static/third/xdate/xdate.js"></script>
<script type="text/javascript" src="/static/third/handlebars/handlebars-1.0.rc.1.js"></script>
<script type="text/javascript" src="/static/third/spin/spin.min.js"></script>
<script type="text/javascript" src="/static/third/jquery-mousewheel/jquery.mousewheel.js"></script>
<script type="text/javascript" src="/static/third/jquery-throttle-debounce/jquery.ba-throttle-debounce.min.js"></script>
<script type="text/javascript" src="/static/third/jquery.idle/jquery.idle.js"></script>
<script type="text/javascript" src="/static/third/jquery-autosize/jquery.autosize.js"></script>
<script type="text/javascript" src="/static/third/spectrum/spectrum.js"></script>
{% compressed_js 'app' %}

{% if debug %}
{% compressed_js 'app_debug' %}
{% endif %}

<script type="text/javascript">

{% autoescape off %}
var page_params = {

    {# Not escaped, because it's guaranteed by the model to be an integer. #}
    initial_pointer: {{ user_profile.pointer }},

    poll_timeout: {{ poll_timeout }},

    fullname: "{{ user_profile.full_name|escapejs }}",
    email: "{{ user_profile.user.email|escapejs }}",
    domain: "{{ user_profile.realm.domain|escapejs }}",
    have_initial_messages: {{ have_initial_messages|escapejs }},
    desktop_notifications_enabled: {{ desktop_notifications_enabled|escapejs }},
    enter_sends: {{ enter_sends|escapejs }},
    debug_mode: {% if debug %} true {% else %} false {% endif %},
    needs_tutorial: {{ needs_tutorial|escapejs }},

    {# We use JSONEncoderForHTML to generate "streams". #}
    stream_list: {{ streams }},

    people_list: [
    {% for person in people %}
        { 'email': "{{ person.email|escapejs }}",
          'full_name': "{{ person.full_name|escapejs }}" },
    {% endfor %}
    ]
};
{% endautoescape %}

</script>
{% endblock %}
{% block content %}
<div class="container-fluid">
    {% include "zephyr/navbar.html" %}
    <div class="row-fluid">
        <div class="span3 hidden-phone">
          {% include "zephyr/left-sidebar.html" %}
        </div><!--/left sidebar-->
        <div class="span7 tab-content">
            <div class="tab-pane active" id="home">
                {% include "zephyr/home.html" %}
            </div>
            <div class="tab-pane" id="subscriptions">
                {% include "zephyr/subscriptions.html" %}
            </div>
            <div class="tab-pane" id="settings">
                {% include "zephyr/settings.html" %}
            </div>

            {% if show_debug %}
            <div class="tab-pane" id="debug">
                {% include "zephyr/debug.html" %}
            </div>
            {% endif %}

        </div><!--/tab-content-->
        <div class="span2 hidden-phone">
          {% include "zephyr/right-sidebar.html" %}
        </div><!--/right sidebar-->
    </div><!--/row-->
    {% include "zephyr/keyboard_shortcuts.html" %}
    {% include "zephyr/markdown_help.html" %}
    {% include "zephyr/invite_user.html" %}
    {% include "zephyr/logout.html" %}
</div>
{% endblock %}

{% extends "zerver/portico.html" %}

{# Login page. #}

{% load minified_js %}

{% block customhead %}
    {{ block.super }}
    {% minified_js 'signup' %}
{% endblock %}

{% block portico_content %}

<script type="text/javascript">
{% if email %}
autofocus('#id_password');
{% else %}
autofocus('#id_username');
{% endif %}
</script>


<div class="app login-page">
  <div class="app-main login-page-container">

    <h3 class="login-page-header">You look familiar.</h3>

{% if only_sso %}
    {% comment %}SSO users don't have a password.{% endcomment %}

    <div class="login-sso">
      <a href="/accounts/login/sso" class="btn btn-large btn-primary">Sign in with SSO</a>
    </div>

{% else %}
{% comment %}Non-SSO users.{% endcomment %}

{% if form.errors or desktop_sso_unknown_email %}
<div class="alert alert-error">
    {% if desktop_sso_unknown_email %}
        Zulip is not currently available for your domain. <br />
        <a href="https://zulip.com/signup">Sign up</a> to find out when Zulip is ready for you.
    {% else %}
        {% for error in form.errors.values %}
        <div>{{ error | striptags }}</div>
        {% endfor %}
    {% endif %}
</div>
{% endif %}

    {% if email %}
    <div class="alert">
        You've already registered with this email address. Please log in below.
    </div>
    {% endif %}

        <form name="login_form" id="login_form" method="post" class="login-form"
            {% if desktop_sso_dispatch %}
            {# desktop_sso_dispatch is only set when this template is invoked by zilencer.views #}
              action="{% url 'zilencer.views.account_deployment_dispatch' %}"
            {% else %}
              action="{% url 'django.contrib.auth.views.login' %}?next={{ next }}"
            {% endif %}
        >
            {% csrf_token %}
            <div class="control-group">
                <label for="id_username" class="control-label">Email</label>
                <div class="controls">
                    <input id="id_username" type="email" name="username" class="email required" value="{{ email }}" maxlength="72" />
                </div>
            </div>

            {% if not desktop_sso_dispatch %}
            <div class="control-group">
                <label for="id_password" class="control-label">Password</label>
                <div class="controls">
                    <input id="id_password" name="password" class="required" type="password" />
                </div>
            </div>
            {% endif %}
            <div class="control-group">
                <div class="controls">
                    <input type="submit" class="btn btn-large btn-primary" value="Log in" />
                    {% if not desktop_sso_dispatch %}
                    <span class="login-forgot-password">
                      <a href="{% url 'django.contrib.auth.views.password_reset' %}">Forgot password?</a>
                    </span>
                    {% endif %}
                </div>
            </div>
        </form>

    {% if not desktop_sso_dispatch %}
    <div class="login-google">
    or <a href="/accounts/login/openid/" class="login-google-button zocial google">Sign in with Google</a>
    </div>
    {% endif %}

{% endif %}

</div>
<div class="footer-padder"></div>
</div>
<script type="text/javascript">
if (window.location.hash.substring(0, 1) === "#") {
    document.login_form.action += window.location.hash;
}
</script>

{% endblock %}

{% block mixpanel_badge %}
      <li class="mixpanel-badge"><a href="https://mixpanel.com/f/partner">
          <img src="//cdn.mxpnl.com/site_media/images/partner/badge_light.png" alt="Mobile Analytics" />
        </a></li>
{% endblock %}
